<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search - EchoVerse</title>
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='images/favicon.svg') }}">
    <link rel="stylesheet" href="/static/css/variables.css">
    <link rel="stylesheet" href="/static/css/home.css">
</head>
<body>
    {% include "_header.html" %}

    <div class="container" style="flex: 1;">
        <main class="feed" style="max-width: 800px; margin: 0 auto;">
            <div class="search-section" style="margin-bottom: var(--space-5);">
                <form method="GET" action="{{ url_for('search') }}" class="search-form">
                    <input type="text" name="q" value="{{ query }}" placeholder="Search users, posts..." class="search-input" required>
                    <button type="submit" class="search-btn">üîç</button>
                </form>
            </div>

            <h2 style="margin-bottom: var(--space-4);">Search Results for "{{ query }}"</h2>
            
            {% if tags %}
            <div class="sidebar-section" style="margin-bottom: var(--space-5);">
                <h3>Tags</h3>
                {% for tag in tags %}
                <div style="display: flex; align-items: center; gap: var(--space-4); padding: var(--space-3); border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <div style="flex: 1;">
                        <a href="{{ url_for('explore', tag=tag.name) }}" style="color: var(--color-accent); text-decoration: none; font-weight: 600; display: block; font-size: 1.1rem;">#{{ tag.name }}</a>
                        <p style="color: var(--color-text-muted); font-size: 0.85rem; margin: 0;">{{ tag.post_count }} posts</p>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            
            {% if users %}
            <div class="sidebar-section" style="margin-bottom: var(--space-5);">
                <h3>Users</h3>
                {% for user_item in users %}
                    {% set user = user_item %}
                    {% set show_follow = True %}
                    {% include "_user_card.html" %}
                {% endfor %}
            </div>
            {% endif %}
            
            {% if posts %}
            <div style="margin-bottom: var(--space-5);">
                <h3 style="margin-bottom: var(--space-4);">Posts</h3>
                {% for post in posts %}
                {% set post_item = post %}
                {% set post = post_item %}
                {% set user_id = current_user_id %}
                {% set show_edit = False %}
                {% include "_post_card.html" %}
                {% endfor %}
            </div>
            {% endif %}
            
            {% if songs %}
            <div style="margin-bottom: var(--space-5);">
                <h3 style="margin-bottom: var(--space-4);">Songs</h3>
                {% for song in songs %}
                <article class="post-card">
                    <div class="post-header">
                        {% set avatar_url = song.user_avatar %}
                        {% set alt_text = song.user_name %}
                        {% set avatar_class = 'avatar' %}
                        {% include "__avatar.html" %}
                        <div class="post-author">
                            <a href="{{ url_for('profile', profile_user_id=song.user_id) }}" class="author-name">{{ song.user_name }}</a>
                            <span class="post-time">{{ song.created_at.strftime('%b %d, %Y') if song.created_at else '' }}</span>
                        </div>
                    </div>
                    <div class="post-content">
                        <strong>{{ song.title }}</strong>
                        {% if song.description %}
                        <p style="margin-top: var(--space-2);">{{ song.description }}</p>
                        {% endif %}
                    </div>
                    {% if song.file_path %}
                    <div class="post-audio">
                        <audio controls class="audio-player">
                            <source src="{{ url_for('static', filename='uploads/' + song.file_path) }}" type="audio/mpeg">
                        </audio>
                    </div>
                    {% endif %}
                    <div class="post-actions">
                        <span class="action-btn">‚ù§Ô∏è {{ song.total_likes or 0 }}</span>
                        {% if song.user_id != current_user_id %}
                        <form method="POST" action="{{ url_for('toggle_follow', user_id=song.user_id) }}" class="action-form" style="display: inline;">
                            <button type="submit" class="action-btn">üë§ Follow</button>
                        </form>
                        {% endif %}
                    </div>
                </article>
                {% endfor %}
            </div>
            {% endif %}
            
            {% if not users and not posts and not songs %}
            <div class="empty-feed">
                <p>No results found for "{{ query }}"</p>
            </div>
            {% endif %}
        </main>
    </div>

    {% include "_footer.html" %}
</body>
</html>

