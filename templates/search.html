<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search - EchoVerse</title>
    <link rel="stylesheet" href="/static/css/variables.css">
    <link rel="stylesheet" href="/static/css/home.css">
</head>
<body>
    <nav class="nav">
        <div class="nav-container">
            <div class="logo">EchoVerse</div>
            <div class="nav-links">
                <a href="{{ url_for('home') }}" class="nav-link">Home</a>
                <a href="#" class="nav-link">Explore</a>
                <a href="{{ url_for('profile') }}" class="nav-link">Profile</a>
            </div>
            <div class="nav-user">
                <a href="{{ url_for('profile') }}" class="user-name">{{ session.get('user_name', '') }}</a>
                <a href="{{ url_for('logout') }}" class="btn btn-small">Logout</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <main class="feed" style="max-width: 800px; margin: 0 auto;">
            <div class="search-section" style="margin-bottom: var(--space-5);">
                <form method="GET" action="{{ url_for('search') }}" class="search-form">
                    <input type="text" name="q" value="{{ query }}" placeholder="Search users, posts..." class="search-input" required>
                    <button type="submit" class="search-btn">üîç</button>
                </form>
            </div>

            <h2 style="margin-bottom: var(--space-4);">Search Results for "{{ query }}"</h2>
            
            {% if users %}
            <div class="sidebar-section" style="margin-bottom: var(--space-5);">
                <h3>Users</h3>
                {% for user in users %}
                <div style="display: flex; align-items: center; gap: var(--space-4); padding: var(--space-3); border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <img src="{% if user.avatar %}{% if user.avatar.startswith('http') %}{{ user.avatar }}{% else %}{{ url_for('static', filename=user.avatar) }}{% endif %}{% else %}https://avatar.iran.liara.run/public/40{% endif %}" 
                         alt="{{ user.name }}" 
                         class="avatar"
                         onerror="this.src='https://avatar.iran.liara.run/public/40'">
                    <div style="flex: 1;">
                        <a href="#" style="color: var(--color-text); text-decoration: none; font-weight: 600; display: block;">{{ user.name }}</a>
                        <p style="color: var(--color-text-muted); font-size: 0.85rem; margin: 0;">{{ user.email }}</p>
                    </div>
                    {% if user.id != current_user_id %}
                    <form method="POST" action="{{ url_for('toggle_follow', user_id=user.id) }}" style="display: inline;">
                        <button type="submit" class="btn btn-small {% if user.get('is_following') %}btn-secondary{% endif %}">
                            {% if user.get('is_following') %}Unfollow{% else %}Follow{% endif %}
                        </button>
                    </form>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% endif %}
            
            {% if posts %}
            <div style="margin-bottom: var(--space-5);">
                <h3 style="margin-bottom: var(--space-4);">Posts</h3>
                {% for post in posts %}
                <article class="post-card">
                    <div class="post-header">
                        <img src="{% if post.user_avatar %}{% if post.user_avatar.startswith('http') %}{{ post.user_avatar }}{% else %}{{ url_for('static', filename=post.user_avatar) }}{% endif %}{% else %}https://avatar.iran.liara.run/public/40{% endif %}" 
                             alt="{{ post.user_name }}" 
                             class="avatar"
                             onerror="this.src='https://avatar.iran.liara.run/public/40'">
                        <div class="post-author">
                            <a href="#" class="author-name">{{ post.user_name }}</a>
                            <span class="post-time">{{ post.created_at.strftime('%b %d, %Y') if post.created_at else '' }}</span>
                        </div>
                    </div>
                    {% if post.content %}
                    <div class="post-content">{{ post.content }}</div>
                    {% endif %}
                    {% if post.media_type == 'audio' and post.media_path %}
                    <div class="post-audio">
                        <audio controls class="audio-player">
                            <source src="{{ url_for('static', filename='uploads/' + post.media_path) }}" type="audio/mpeg">
                        </audio>
                    </div>
                    {% endif %}
                    <div class="post-actions">
                        <span class="action-btn">‚ù§Ô∏è {{ post.total_likes or 0 }}</span>
                        {% if post.user_id != current_user_id %}
                        <form method="POST" action="{{ url_for('toggle_follow', user_id=post.user_id) }}" class="action-form" style="display: inline;">
                            <button type="submit" class="action-btn">üë§ Follow</button>
                        </form>
                        {% endif %}
                    </div>
                </article>
                {% endfor %}
            </div>
            {% endif %}
            
            {% if songs %}
            <div style="margin-bottom: var(--space-5);">
                <h3 style="margin-bottom: var(--space-4);">Songs</h3>
                {% for song in songs %}
                <article class="post-card">
                    <div class="post-header">
                        <img src="{% if song.user_avatar %}{% if song.user_avatar.startswith('http') %}{{ song.user_avatar }}{% else %}{{ url_for('static', filename=song.user_avatar) }}{% endif %}{% else %}https://avatar.iran.liara.run/public/40{% endif %}" 
                             alt="{{ song.user_name }}" 
                             class="avatar"
                             onerror="this.src='https://avatar.iran.liara.run/public/40'">
                        <div class="post-author">
                            <a href="#" class="author-name">{{ song.user_name }}</a>
                            <span class="post-time">{{ song.created_at.strftime('%b %d, %Y') if song.created_at else '' }}</span>
                        </div>
                    </div>
                    <div class="post-content">
                        <strong>{{ song.title }}</strong>
                        {% if song.description %}
                        <p style="margin-top: var(--space-2);">{{ song.description }}</p>
                        {% endif %}
                    </div>
                    {% if song.file_path %}
                    <div class="post-audio">
                        <audio controls class="audio-player">
                            <source src="{{ url_for('static', filename='uploads/' + song.file_path) }}" type="audio/mpeg">
                        </audio>
                    </div>
                    {% endif %}
                    <div class="post-actions">
                        <span class="action-btn">‚ù§Ô∏è {{ song.total_likes or 0 }}</span>
                        {% if song.user_id != current_user_id %}
                        <form method="POST" action="{{ url_for('toggle_follow', user_id=song.user_id) }}" class="action-form" style="display: inline;">
                            <button type="submit" class="action-btn">üë§ Follow</button>
                        </form>
                        {% endif %}
                    </div>
                </article>
                {% endfor %}
            </div>
            {% endif %}
            
            {% if not users and not posts and not songs %}
            <div class="empty-feed">
                <p>No results found for "{{ query }}"</p>
            </div>
            {% endif %}
        </main>
    </div>
</body>
</html>

