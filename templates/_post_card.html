{# Post card component #}
{# Usage: {% set post = post_item %}{% set user_id = current_user_id %}{% set show_edit = True %}{% include "_post_card.html" %} #}
<article class="post-card" id="post-{{ post.id }}">
    <div class="post-header">
        {% set avatar_url = post.user_avatar %}
        {% set alt_text = post.user_name %}
        {% set avatar_class = 'avatar' %}
        {% include "__avatar.html" %}
        <div class="post-author">
            <a href="{{ url_for('profile', profile_user_id=post.user_id) }}" class="author-name">{{ post.user_name }}</a>
            <span class="post-time">{{ post.created_at.strftime('%b %d, %Y') if post.created_at else '' }}</span>
        </div>
    </div>
    
    <!-- Post View Mode -->
    <div class="post-view" id="post-view-{{ post.id }}">
        {% if post.content %}
        <div class="post-content">
            {{ post.content }}
        </div>
        {% endif %}
        
        {% if post.media_type == 'audio' and post.media_path %}
        <div class="post-audio">
            <audio controls class="audio-player">
                <source src="{{ url_for('static', filename='uploads/' + post.media_path) }}" type="audio/mpeg">
                Your browser does not support the audio element.
            </audio>
        </div>
        {% endif %}
        
        {% if post.tags %}
        <div class="post-tags" style="margin-top: var(--space-3);">
            {% for tag in post.tags.split(', ') %}
                <a href="{{ url_for('explore', tag_name=tag.strip()) }}" class="tag-link">#{{ tag.strip() }}</a>
            {% endfor %}
        </div>
        {% endif %}
    </div>
    
    <!-- Post Edit Mode (hidden by default) -->
    {% if show_edit and post.post_owner_id == user_id %}
    <div class="post-edit" id="post-edit-{{ post.id }}" style="display: none;">
        <form method="POST" action="{{ url_for('edit_post', post_id=post.id) }}" enctype="multipart/form-data" class="inline-edit-form">
            <textarea name="content" rows="3" class="inline-edit-input" placeholder="Share your sound...">{{ post.content or '' }}</textarea>
            
            {% if post.media_type == 'audio' and post.media_path %}
            <div style="margin: var(--space-3) 0;">
                <p style="color: var(--color-text-muted); font-size: 0.85rem; margin-bottom: var(--space-2);">Current audio:</p>
                <audio controls class="audio-player" style="width: 100%;">
                    <source src="{{ url_for('static', filename='uploads/' + post.media_path) }}" type="audio/mpeg">
                </audio>
                <p style="color: var(--color-text-muted); font-size: 0.85rem; margin-top: var(--space-2);">
                    Upload new file to replace, or leave empty to keep current audio.
                </p>
            </div>
            {% endif %}
            
            <label class="file-upload-label" style="margin: var(--space-3) 0;">
                <input type="file" name="audio_file" accept="audio/*" style="display: none;">
                <span class="file-upload-text">üéµ {% if post.media_type == 'audio' %}Replace Audio{% else %}Upload Audio{% endif %}</span>
            </label>
            
            <input type="text" name="tags" placeholder="Tags (e.g., music, beats, new)" 
                   value="{{ post.tags or '' }}"
                   style="flex: 1; padding: var(--space-3); background-color: var(--color-bg); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: var(--radius-sm); color: var(--color-text); font-size: 0.9rem; margin-bottom: var(--space-3);"
                   maxlength="200">
            
            <div class="inline-edit-actions">
                <button type="submit" class="btn btn-primary btn-small">Save</button>
                <button type="button" class="btn btn-small" onclick="cancelEdit({{ post.id }})">Cancel</button>
            </div>
        </form>
    </div>
    {% endif %}
    
    <div class="post-actions">
        <button type="button" class="action-btn {% if post.user_liked %}liked{% endif %}" onclick="toggleLike({{ post.id }})" id="like-btn-{{ post.id }}">
             <span class="like-icon">{% if post.user_liked %}‚ù§Ô∏è{% else %}ü§ç{% endif %}</span> <span id="like-count-{{ post.id }}">{{ post.total_likes or 0 }}</span>
        </button>
        <button class="action-btn" onclick="toggleComments({{ post.id }})" id="comment-btn-{{ post.id }}">
            üí¨ Comment <span id="comment-count-{{ post.id }}">{% if post.comment_count %}({{ post.comment_count }}){% endif %}</span>
        </button>
        {% if show_edit and post.post_owner_id == user_id %}
        <button class="action-btn" onclick="toggleEdit({{ post.id }})">‚úèÔ∏è Edit</button>
        <button type="button" class="action-btn delete-btn" onclick="deletePost({{ post.id }})">üóëÔ∏è Delete</button>
        {% endif %}
    </div>
    
    <!-- Comments Section (hidden by default) -->
    <div class="comments-section" id="comments-{{ post.id }}" style="display: none;">
        <form class="comment-form" id="comment-form-{{ post.id }}" onsubmit="return addComment(event, {{ post.id }})">
            <input type="text" name="content" placeholder="Write a comment..." class="comment-input" required maxlength="500" minlength="1">
            <button type="submit" class="btn btn-small">Post</button>
        </form>
        <div class="comments-list">
            {% if post.comments %}
                {% for comment_item in post.comments %}
                    {% set comment = comment_item %}
                    {% include "__comment.html" %}
                {% endfor %}
            {% else %}
                <p style="color: var(--color-text-muted); font-size: 0.9rem; padding: var(--space-3);">No comments yet. Be the first to comment!</p>
            {% endif %}
        </div>
    </div>
</article>

