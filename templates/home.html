<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - EchoVerse</title>
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='images/favicon.svg') }}">
    {% if session.get('user') or session.get('user_id') %}
    <link rel="prefetch" href="{{ url_for('explore') }}">
    <link rel="prefetch" href="{{ url_for('profile') }}">
    {% if is_admin %}
    <link rel="prefetch" href="{{ url_for('admin_panel') }}">
    {% endif %}
    {% endif %}
    <link rel="stylesheet" href="/static/css/variables.css">
    <link rel="stylesheet" href="/static/css/home.css">
</head>
<body>
    {% include "_header.html" %}

    <div class="container" style="flex: 1;">
        <!-- Left Sidebar -->
        <aside class="sidebar-left">
            <div class="sidebar-section">
                <h3>{{ x.lans("your_stats") if x.lans else "Your Stats" }}</h3>
                <div class="stats">
                    {% set stat_value = following %}{% set stat_label = x.lans("following") if x.lans else "Following" %}{% include "_stat_item.html" %}
                    {% set stat_value = followers %}{% set stat_label = x.lans("followers") if x.lans else "Followers" %}{% include "_stat_item.html" %}
                </div>
            </div>
        </aside>

        <!-- Main Feed -->
        <main class="feed">
            <!-- Post Composer -->
            <div class="post-composer">
                <form method="POST" action="{{ url_for('create_post') }}" enctype="multipart/form-data" class="composer-form" id="post-form">
                    <div class="composer-header">
                        {% set avatar_url = current_user_avatar %}{% set alt_text = 'Avatar' %}{% set avatar_class = 'avatar-small' %}{% include "__avatar.html" %}
                        <textarea name="content" placeholder="{{ x.lans('share_your_sound') if x.lans else 'Share your sound...' }}" rows="3" class="composer-input" maxlength="500" id="post-content"></textarea>
                    </div>
                    <div class="composer-actions">
                        <label class="file-upload-btn">
                            <input type="file" name="audio_file" accept="audio/*" style="display: none;" id="audio-file-input">
                            ðŸŽµ {{ x.lans("upload_audio") if x.lans else "Upload Audio" }}
                        </label>
                        <div style="flex: 1; position: relative; min-width: 200px; max-width: calc(100% - 300px);">
                            <input type="text" name="tags" id="tags-input" placeholder="{{ x.lans('tags_placeholder') if x.lans else 'Tags (comma-separated: music, beats, new)' }}" 
                                   style="width: 100%; padding: var(--space-3); background-color: var(--color-bg-secondary); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: var(--radius-sm); color: var(--color-text); font-size: 0.9rem;"
                                   maxlength="200" autocomplete="off">
                            <div id="tag-suggestions" style="display: none; position: absolute; top: calc(100% + 2px); left: 0; width: 100%; background: var(--color-bg-secondary); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: var(--radius-sm); max-height: 200px; overflow-y: auto; z-index: 1000; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);"></div>
                        </div>
                        <button type="submit" class="btn btn-primary" style="flex-shrink: 0;">{{ x.lans("post_button") if x.lans else "Post" }}</button>
                    </div>
                    <div id="post-error" style="color: var(--color-error); margin-top: var(--space-2); display: none;"></div>
                </form>
            </div>

            <!-- Posts Feed -->
            <div class="posts-feed">
                {% if error %}
                <div class="error-message">{{ error }}</div>
                {% endif %}
                
                {% if posts %}
                    {% for post_item in posts %}
                        {% set post = post_item %}
                        {% set show_edit = True %}
                        {% include "_post_card.html" %}
                    {% endfor %}
                {% else %}
                    <div class="empty-feed">
                        <p>{{ x.lans("no_posts_yet") if x.lans else "No posts yet. Be the first to share your sound!" }}</p>
                    </div>
                {% endif %}
            </div>
        </main>

        <!-- Right Sidebar -->
        <aside class="sidebar-right">
            <!-- Search Bar -->
            <div class="sidebar-section">
                <h3>{{ x.lans("search") if x.lans else "Search" }}</h3>
                <form class="search-form" id="search-form" onsubmit="return false;">
                    <input type="text" name="q" id="search-input" placeholder="{{ x.lans('search_placeholder') if x.lans else 'Search users, posts...' }}" class="search-input" 
                           oninput="handleLiveSearch(this.value)">
                    <button type="button" class="search-btn" onclick="clearSearch()">âœ•</button>
                </form>
                
                <!-- Live Search Results -->
                <div id="live-search-results" class="live-search-results" style="display: none;">
                    <!-- Results will appear here as user types -->
                </div>
            </div>

            <div class="sidebar-section">
                <h3>{{ x.lans("trending") if x.lans else "Trending" }}</h3>
                <div class="trending-list">
                    {% if trending_tags %}
                        {% for tag in trending_tags %}
                        <a href="{{ url_for('explore', tag_name=tag.name) }}" class="trending-item">#{{ tag.name }}</a>
                        {% endfor %}
                    {% else %}
                        <div class="trending-item">{{ x.lans("no_trending_tags") if x.lans else "No trending tags yet" }}</div>
                    {% endif %}
                </div>
            </div>
        </aside>
    </div>

    {% include "_footer.html" %}

    <script src="/static/js/home.js"></script>
</body>
</html>

